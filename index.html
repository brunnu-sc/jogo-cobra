<!DOCTYPE html>
<html>

<head>
    <title>Jogo da Cobrinha</title>
    <link rel="stylesheet" href="css/estilo.css">
</head>

<body>
    <div id="info">
        <h1>PONTUAÇÃO: 0</h1>
        <h1>RECORDE: 0</h1>
    </div>

    <div class="campo">
        <canvas id="stage" width="600" height="600"></canvas>
        <script type="text/javascript">
            var pontuacao = 0;
            var record = 0;

            window.onload = function() {
                var stage = document.getElementById('stage');
                var ctx = stage.getContext("2d");
                document.addEventListener("keydown", keyPush);
                setInterval(jogo, 150);

                const velocidade = 1;
                var velocidadeX = 0;
                var velocidadeY = 0;
                var pontoX = 10;
                var pontoY = 15;
                var tamanhoPonto = 30;
                var quantidadePonto = 20;
                var posicaoMacaX = 15;
                var posicaoMacaY = 15;
                var direcao = 0;

                var rastro = [];
                tamanhoCobra = 1;

                function jogo() {

                    pontoX += velocidadeX;
                    pontoY += velocidadeY;
                    if (pontoX < 0) {
                        velocidadeX = velocidadeY = 0;
                        pontoX = 10;
                        pontoY = 15;
                        tamanhoCobra = 1;
                        recorde = pontuacao
                        pontuacao = 0
                    }
                    if (pontoX > quantidadePonto - 1) {
                        velocidadeX = velocidadeY = 0;
                        pontoX = 10;
                        pontoY = 15;
                        tamanhoCobra = 1;
                        recorde = pontuacao
                        pontuacao = 0
                    }
                    if (pontoY < 0) {
                        velocidadeX = velocidadeY = 0;
                        pontoX = 10;
                        pontoY = 15;
                        tamanhoCobra = 1;
                        recorde = pontuacao
                        pontuacao = 0
                    }
                    if (pontoY > quantidadePonto - 1) {
                        velocidadeX = velocidadeY = 0;
                        pontoX = 10;
                        pontoY = 15;
                        tamanhoCobra = 1;
                        recorde = pontuacao
                        pontuacao = 0
                    }

                    ctx.fillStyle = "green";
                    ctx.fillRect(0, 0, stage.width, stage.height);

                    ctx.fillStyle = "red";
                    ctx.fillRect(posicaoMacaX * tamanhoPonto, posicaoMacaY * tamanhoPonto, tamanhoPonto, tamanhoPonto);

                    ctx.fillStyle = "black";
                    for (var i = 0; i < rastro.length; i++) {
                        ctx.fillRect(rastro[i].x * tamanhoPonto, rastro[i].y * tamanhoPonto, tamanhoPonto - 1, tamanhoPonto - 1);
                        if (rastro[i].x == pontoX && rastro[i].y == pontoY) {
                            velocidadeX = velocidadeY = 0;
                            recorde = pontuacao;
                            pontuacao = 0;
                            tamanhoCobra = 1;
                        }
                    }

                    rastro.push({
                        x: pontoX,
                        y: pontoY
                    })
                    while (rastro.length > tamanhoCobra) {
                        rastro.shift();
                    }
                    if (posicaoMacaX == pontoX && posicaoMacaY == pontoY) {
                        tamanhoCobra++;
                        pontuacao++;
                        posicaoMacaX = Math.floor(Math.random() * quantidadePonto);
                        posicaoMacaY = Math.floor(Math.random() * quantidadePonto);
                    }

                }

                function keyPush(event) {

                    switch (event.keyCode) {
                        case 37:

                            if (direcao != 39) {
                                direcao = 37;
                                velocidadeX = -velocidade;
                                velocidadeY = 0;
                            }
                            break;
                        case 38:
                            if (direcao != 40) {
                                direcao = 38;
                                velocidadeX = 0;
                                velocidadeY = -velocidade;
                            }
                            break;
                        case 39:
                            if (direcao != 37) {
                                direcao = 39;
                                velocidadeX = velocidade;
                                velocidadeY = 0;
                            }
                            break;
                        case 40:
                            if (direcao != 38) {
                                direcao = 40;
                                velocidadeX = 0;
                                velocidadeY = velocidade;
                            }
                            break;
                        default:
                            break;
                    }

                }
            }
        </script>
    </div>

</body>

</html>